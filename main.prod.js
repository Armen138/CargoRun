// console.log(c);

define("raf",[],function(){var e=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,17)};return{requestAnimationFrame:e}}),define("canvas",[],function(){function t(e){e=e||document.createElement("canvas");var n=e.getContext("2d"),r={element:e,context:n,imageData:function(t){return t&&n.putImageData(t,0,0),n.getImageData(0,0,e.width,e.height)},create:function(e){var n=t();return n.size(e),n},clone:function(e){var n=t();return n.size(r.size()),e||n.context.drawImage(r.element,0,0),n},clear:function(t){t?(n.save(),n.fillStyle=t,n.fillRect(0,0,e.width,e.height),n.restore()):e.width=e.width},size:function(t,n){return t&&(typeof t=="object"?(e.width=t.W||t.width,e.height=t.H||t.height):(e.width=t,e.height=n)),{width:e.width,height:e.height}}};return Object.defineProperty(r,"width",{get:function(){return e.width},set:function(t){e.width=t}}),Object.defineProperty(r,"height",{get:function(){return e.height},set:function(t){e.height=t}}),r.position=function(){var e=0,t=0,n=r.element;while(n)e+=n.offsetLeft,t+=n.offsetTop,n=n.parentElement;return{X:e,Y:t}}(),r}var e=document.getElementsByTagName("canvas")[0];return t(e)}),define("game",["raf","canvas"],function(e,t){"strict mode";var n={run:function(){n.state&&n.state.run(),e.requestAnimationFrame.call(window,n.run)},touches:{}},r=null;return Object.defineProperty(n,"state",{get:function(){return r},set:function(e){r?r.clear(function(){e.init(),r=e}):(e.init(),r=e)}}),window.addEventListener("keyup",function(e){n.state&&n.state.keyup&&n.state.keyup(e.keyCode),e.keyCode===27&&(n.state=n.paused)}),window.addEventListener("keydown",function(e){n.state&&n.state.keydown&&n.state.keydown(e.keyCode)}),window.addEventListener("mousemove",function(e){if(n.state&&n.state.mousemove){var r=e.clientX-t.position.X,i=e.clientY-t.position.Y;n.state.mousemove({X:r,Y:i})}}),window.addEventListener("click",function(e){if(n.state&&n.state.click){var r=e.clientX-t.position.X,i=e.clientY-t.position.Y;n.state.click({X:r,Y:i})}}),window.addEventListener("mousedown",function(e){if(n.state&&n.state.mousedown){var r=e.clientX-t.position.X,i=e.clientY-t.position.Y;n.state.mousedown({X:r,Y:i})}}),window.addEventListener("mouseup",function(e){if(n.state&&n.state.mouseup){var r=e.clientX-t.position.X,i=e.clientY-t.position.Y;n.state.mouseup({X:r,Y:i})}}),window.addEventListener("touchstart",function(e){console.log("touchstart");if(n.state&&n.state.mousedown){var t=e.changedTouches;if(t.length>0){var r=t[0].pageX|0,i=t[0].pageY|0;n.state.mousedown({X:r,Y:i}),n.touches[t[0].identifier]=Date.now()}}}),window.addEventListener("touchmove",function(e){console.log("touchmove");if(n.state&&n.state.mousemove){var t=e.changedTouches;if(t.length>0){var r=t[0].pageX|0,i=t[0].pageY|0;n.state.mousemove({X:r,Y:i})}}}),window.addEventListener("touchend",function(e){console.log("touchend");var t=e.changedTouches;if(n.state&&n.state.mouseup&&t.length>0){var r=t[0].pageX|0,i=t[0].pageY|0;n.state.mouseup({X:r,Y:i})}console.log(n.touches[t[0].identifier]),console.log(Date.now()-n.touches[t[0].identifier]);if(n.state.click){var r=t[0].pageX|0,i=t[0].pageY|0;n.state.click({X:r,Y:i})}}),n}),function(){var e={attach:function(e){var t={},n={on:function(n,r){return t[n]||(t[n]=[]),t[n].push(r),e},fire:function(n,r){if(t[n])for(var i=0;i<t[n].length;i++)if(t[n][i].call(e,r))return},remove:function(e,n){if(!t[e])return;for(var r=0;r<t[e].length;r++)if(t[e][r]===n){t[e].splice(r,1);break}}};for(var r in n)e[r]=n[r]}};define("events",e)}(),define("events",function(){}),function(){function e(e,t){var n=new Audio,r=3,i=[],s=e.substr(e.lastIndexOf(".")+1).toLowerCase();t=t||function(e){console.log("no callback set for loading audio.")};var o={canPlay:{mp3:n.canPlayType("audio/mpeg"),ogg:n.canPlayType("audio/ogg"),wav:n.canPlayType("audio/wav")},volume:function(e){for(var t=0;t<i.length;t++)i[t].volume=e},play:function(t){for(var n=0;n<r;n++){n>=i.length&&(i[n]=new Audio(e),i[n].load&&i[n].load());if(i[n].currentTime===0||i[n].ended){i[n].loop=t,i[n].play();return}}i[0].pause(),i[0].loop=t,i[0].currentTime=0,i[0].play()},stop:function(){for(var e=0;e<i.length;e++)i[e]&&!i[e].paused&&(i[e].pause(),i[e].currentTime=0)}};return o.canPlay[s]?(i.push(new Audio(e)),i[0].load&&i[0].load(),t(!0)):(t(!1),console.log("This filetype cannot be played on this browser: "+s)),o}var t={create:e};typeof define!="undefined"?define("racket",t):window.Racket=t}(),define("racket",function(){}),define("resources",["events","racket"],function(e,t){if(window._GAME_RESOURCES_)return window._GAME_RESOURCES_;var n=null,r=/(wav$|mp3$|ogg$)/,i=/(3d$|js$|json$)/,s={loaded:0,load:function(e){function o(e){s.load.loaded++,s.fire("progress",e),s.load.loaded===s.load.total&&s.fire("load")}s.load.total=0,s.load.loaded=0;for(var u in e){if(s[u])throw"naming conflict: cannot load resource named "+u;var a="image";console.log(u+" is audio: "+r.test(e[u])),r.test(e[u])&&(a="audio"),i.test(e[u])&&(a="mesh"),s.load.total++;switch(a){case"audio":(function(n){s[n]=t.create(e[n],function(t){t||console.log("failed to load: "+e[n]),o(n)})})(u);break;case"mesh":n===null&&(n=new THREE.JSONLoader),function(t){n.load(e[t],function(e,n){console.log(n),console.log("3d file loaded");var r=new THREE.MeshFaceMaterial(n);s[t]={geometry:e,material:r},o(t)})}(u);break;default:var f=new Image;(function(t,n){t.onload=function(){o(n)},t.onerror=function(){console.log("failed to load: "+e[n]),o(n)}})(f,u),f.src=e[u],f.setAttribute("class","resources"),f.setAttribute("name",u),s[u]=f}}}};return e.attach(s),window._GAME_RESOURCES_=s,s}),define("easing",[],function(){return function(e,t,n,r){return(e/=r)<1/2.75?n*7.5625*e*e+t:e<2/2.75?n*(7.5625*(e-=1.5/2.75)*e+.75)+t:e<2.5/2.75?n*(7.5625*(e-=2.25/2.75)*e+.9375)+t:n*(7.5625*(e-=2.625/2.75)*e+.984375)+t}}),define("menu",["easing"],function(e){function s(e,t){var n={X:10,Y:10+e*120,W:280,H:100};return t.X>n.X&&t.X<n.X+n.W&&t.Y>n.Y&&t.Y<n.Y+n.H?!0:!1}var t="rgba(0, 0, 0, 0.7)",n=324,r=80,i=500;return function(o,u,a){var f=0,l,c,h={X:0,Y:0},p=o.getContext("2d"),d=0,v={font:"48px GputeksRegular",click:function(e){if(e.X<n)for(var t=0;t<u.length;t++)s(t,e)&&u[t].action()},run:function(){if(f===0)return;var s=Date.now()-f,m=-1,g=o.width;a&&c<0&&(m=1,g=o.width-a.width),s<i?(h.X=e(s,l,c,i)|0,a&&(d=e(s,g,m*a.width,i)|0)):(h.X=l+c,a&&(d=o.width-a.width),c<0&&v.done&&v.done()),p.save(),p.drawImage(v.background,0,0),a&&p.drawImage(a,d,o.height/2-a.height/2),p.fillStyle=t,p.fillRect(h.X-r,h.Y,n+r,o.height),p.translate(h.X,h.Y),p.textBaseline="middle",p.textAlign="center",p.font=v.font;for(var y=0;y<u.length;y++){var b=u[y].icon?37:0;u[y].label&&(p.fillStyle=t,p.fillStyle="white",p.fillText(u[y].label,150+b,60+y*120)),u[y].icon&&p.drawImage(u[y].icon,0,0,u[y].icon.width,u[y].icon.height,37,37+y*120,48,48)}p.restore()},init:function(){v.background=document.createElement("canvas"),v.background.width=o.width,v.background.height=o.height,v.background.getContext("2d").drawImage(o,0,0),f=Date.now(),l=-n,c=n,h.X=l},lifetime:function(){return Date.now()-f},clear:function(e){v.time=Date.now()-f,f=Date.now(),l=0,c=-n,h.X=l,v.done=e}};return v}}),define("keys",{BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPSLOCK:20,ESC:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,W:87,A:65,S:83,D:68,NUMLOCK:144,SCROLLLOCK:145}),define("trail",[],function(){var e=50,t=100,n={size:{type:"f",value:[]},alpha:{type:"f",value:[]}},r={color:{type:"c",value:new THREE.Color(16711680)},texture1:{type:"t",value:THREE.ImageUtils.loadTexture("images/particle.png")}},i=function(i,s,o){var u=new THREE.Geometry,a=new THREE.ShaderMaterial({attributes:n,uniforms:r,vertexShader:document.getElementById("vertexshader").textContent,fragmentShader:document.getElementById("fragmentshader").textContent,transparent:!0}),f=[];for(var l=0;l<e;l++){var c=new THREE.Vector3(0,0,0);c.active=!1,c.range=50,c.time=0,c.start={x:0,y:0,z:0},c.velocity=new THREE.Vector3(0,0,0),u.vertices.push(c),f.push(c)}var h=new THREE.ParticleSystem(u,a);h.sortParticles=!0,i.add(h);var p={emit:!0,update:function(){var e=5;if(p.emit&&f.length>e)for(var r=0;r<e;r++){var i=f.shift();i.active=!0,i.x=s.position.x+Math.random()*2-1+o.x,i.y=s.position.y-Math.random()*10+o.y,i.z=s.position.z+o.z,i.time=Date.now(),i.velocity=new THREE.Vector3(0,0,0)}f.length<e&&console.log("Insufficient particles in pool.");for(var r=u.vertices.length-1;r>=0;--r){var a=u.vertices[r];if(a.active){a.add(a.velocity);var l=Date.now()-a.time,c=s.position.distanceTo(a);n.alpha.value[r]=1-l/t,n.size.value[r]=20-l/t*20,l>t&&(n.alpha.value[r]=0,a.active=!1,a.x=0,a.y=0,a.z=0,f.push(a))}}}};return p};return i}),define("ship",["resources","trail","easing"],function(e,t,n){var r=50,i={rotation:.7,strafes:135,ttl:100,jump:500},s={max:10,current:0,sideways:0,gravity:1,jump:4},o=function(n,r){function p(){h.update()}function d(){o.position.x<-i.strafes&&(o.position.x=-i.strafes),o.position.x>i.strafes&&(o.position.x=i.strafes),o.rotation.z<-i.rotation&&(o.rotation.z=-i.rotation),o.rotation.z>i.rotation&&(o.rotation.z=i.rotation),!v.turbo&&s.current>s.max&&(s.current=s.max),v.turbo&&s.current>s.max*2&&(s.current=s.max*2),s.current<0&&(s.current=0),s.sideways>s.max&&(s.sidways=s.max),s.sideways<-s.max&&(s.sideways=-s.max)}var o=new THREE.Mesh(e.ship.geometry,e.ship.material);o.rotation.x+=Math.PI/2,o.rotation.y=Math.PI,o.scale.set(2,2,2),o.castShadow=!0,o.name="ship";var u=new THREE.Raycaster,a=new THREE.Raycaster,f=new THREE.Vector3(0,1,0),l=new THREE.Vector3(0,0,-1),c=0;n.add(o);var h=t(n,o,new THREE.Vector3(0,-5,0)),v={turbo:!1,mesh:o,control:{left:!1,right:!1,jump:function(){c=Date.now()}},update:function(e){var t=Date.now(),m=o.position.clone();m.y-=10,m.z+=5,a.set(m,f),u.set(o.position,l);var g=u.intersectObject(n,!0),y=a.intersectObject(n,!0);g.length>0?(g[0].distance>10&&(o.position.z-=s.gravity),g[0].distance<10&&(o.position.z+=10-g[0].distance)):(console.log("no more ground!"),o.position.z-=s.gravity);if(y.length>0)for(var b=0;b<y.length;b++)o.position.y>20&&y[b].object.name!=="ship"&&y[b].distance<20&&(console.log("die"),o.position.y-=20-y[b].distance,r.position.y-=20-y[b].distance,s.current=0);if(t-c<i.jump){var w=s.jump-s.jump*(t-c)/i.jump;o.position.z+=w}p(),v.control.left&&(s.sideways-=e/500,o.rotation.z-=e/500),v.control.right&&(s.sideways+=e/500,o.rotation.z+=e/500),v.control.up?(h.emit=!0,s.current+=e/500):(h.emit=!1,s.current-=e/500),!v.control.left&&!v.control.right&&o.rotation.z!==0&&(o.rotation.z<0&&(o.rotation.z+=e/500),o.rotation.z>0&&(o.rotation.z-=e/500),s.sideways<0&&(s.sideways+=e/800),s.sideways>0&&(s.sideways-=e/800)),d(),o.position.y+=s.current,o.position.x+=s.sideways,r.position.y+=s.current}};return window.ship=v,v};return o}),define("fuel",["resources","events"],function(e,t){var n=function(n,r,i){var s=!1,o=new THREE.Mesh(e.fuel.geometry,e.fuel.material);o.rotation.x+=Math.PI/2,o.rotation.y=Math.PI,o.scale.set(5,5,5),o.castShadow=!0,o.position=r,o.name="fuel",n.add(o);var u={update:function(e){s||(o.rotation.y+=e/500,i.mesh.position.distanceTo(o.position)<25&&(console.log("hit fuel"),s=!0,n.remove(o),u.fire("pick-up")))}};return t.attach(u),u};return n}),define("stars",["resources"],function(e){var t=500,n=5e3,r=new THREE.Geometry,i=function(i,s){var o=new THREE.Texture(e.star),u=new THREE.ParticleBasicMaterial({color:16777215,size:30,map:THREE.ImageUtils.loadTexture("images/star.png"),blending:THREE.AdditiveBlending,transparent:!0});console.log(e.star);for(var a=0;a<t;a++){var f=500,l=1;Math.random()<.5&&(l=-1);var c=(Math.random()*1500+f)*l,h=Math.random()*n,p=Math.random()*1500-750,d=new THREE.Vector3(c,h,p);r.vertices.push(d)}var v=new THREE.ParticleSystem(r,u);v.sortParticles=!0,i.add(v);var m={update:function(){for(var e=0;e<r.vertices.length;e++)s.mesh.position.y>r.vertices[e].y+100&&(r.vertices[e].y=s.mesh.position.y+Math.random()*n+n)}};return m};return i}),define("explosion",["events"],function(e){var t=500,n=function(n,r,i){var s={size:{type:"f",value:[]},alpha:{type:"f",value:[]}},o={color:{type:"c",value:new THREE.Color(16711680)},texture1:{type:"t",value:THREE.ImageUtils.loadTexture("images/star.png")}};r||(r=new THREE.Vector3(0,0,0));var u=0,a=new THREE.Geometry,f=new THREE.ShaderMaterial({attributes:s,uniforms:o,vertexShader:document.getElementById("vertexshader").textContent,fragmentShader:document.getElementById("fragmentshader").textContent,transparent:!0});for(var l=0;l<t;l++){var c=r.clone();c.active=!0,c.range=10,c.time=0,c.start=r,c.velocity=new THREE.Vector3(Math.random()*2-1,Math.random()*2-1,Math.random()*2-1),a.vertices.push(c)}var h=new THREE.ParticleSystem(a,f);h.sortParticles=!0,n.add(h),console.log("splode"),i||(i={});var p={system:h,update:function(){u===a.vertices.length&&(p.fire("end"),n.remove(h));for(var e=0;e<a.vertices.length;e++){var t=a.vertices[e];if(t.active){var r=t.start.distanceTo(t);s.alpha.value[e]=1-r/t.range,s.size.value[e]=20-r/t.range*20,t.add(t.velocity),r>t.range&&(t.active=!1,u++)}}}};return e.attach(p),p};return n}),define("world",["resources"],function(e){var t=[],n=[],r=6,i=0,s=function(n,i){var s=THREE.ImageUtils.loadTexture("images/plate1.png");s.wrapS=s.wrapT=THREE.RepeatWrapping,s.repeat.set(5,5);var o=new THREE.MeshLambertMaterial({map:s});for(var u=0;u<r;u++){var a=new THREE.Mesh(new THREE.PlaneGeometry(400,400,1,1),o);a.position.z=-30,a.position.y=200+u*400,a.name="plane",n.add(a),t.push(a)}console.log(e.bump);var f=new THREE.Mesh(e.bridge.geometry,e.bridge.material);f.position.y=2e3,f.position.x=0,f.position.z=0,f.scale.set(17,17,17),f.rotation.x+=Math.PI/2,f.rotation.y=Math.PI/2+Math.PI,f.name="bridge",n.add(f);var l={update:function(e){if(i.mesh.position.y>t[0].position.y+400){var n=t.shift();n.position.y+=r*400,t.push(n)}}};return l};return s}),define("play",["canvas","resources","keys","events","ship","fuel","stars","explosion","world"],function(e,t,n,r,i,s,o,u,a){function c(){e.clear("black"),e.context.save();for(var n=0;n<l.fuel;n++)e.context.drawImage(t.fuelicon,10+n*36,10);e.context.restore()}var f=0,l={fuel:0},h=function(e){var t={updates:[],init:function(){console.log("glinit");if(!t.light){t.ship=i(e.scene,e.camera),t.world=a(e.scene,t.ship),t.fuel=[],t.stars=o(e.scene,t.ship);for(var n=0;n<10;n++)(function(){var n=s(e.scene,new THREE.Vector3(Math.random()*250-125,Math.random()*1e3,0),t.ship);n.on("pick-up",function(){var e=u(t.ship.mesh,new THREE.Vector3(0,0,0));e.on("end",function(){}),l.fuel++,t.updates.push(e)}),t.fuel.push(n)})();var r=new THREE.PointLight(16777215);r.position.x=0,r.position.y=0,r.position.z=0,t.light=r,e.camera.add(r),e.camera.position.y=-200,e.camera.position.z=100}},run:function(){var n=Date.now();t.world.update(n-f),t.stars.update(),t.ship.update(n-f);for(var r=0;r<t.fuel.length;r++)t.fuel[r].update(n-f);for(var r=0;r<t.updates.length;r++)t.updates[r].update(n-f);e.renderer.render(e.scene,e.camera),c(),f=n},clear:function(e){e()},reset:function(){e.scene.remove(t.ship)},keydown:function(r){switch(r){case n.RIGHT:t.ship.control.right=!0;break;case n.LEFT:t.ship.control.left=!0;break;case n.UP:t.ship.control.up=!0;break;case n.DOWN:t.ship.control.down=!0;break;case n.SPACE:l.fuel>0&&(l.fuel--,t.ship.control.jump(),function(){var n=u(e.scene,t.ship.mesh.position.clone());n.on("end",function(){}),t.updates.push(n)}());break;default:}},keyup:function(e){switch(e){case n.RIGHT:t.ship.control.right=!1;break;case n.LEFT:t.ship.control.left=!1;break;case n.UP:t.ship.control.up=!1;break;case n.DOWN:t.ship.control.down=!1;break;case n.SPACE:break;default:}}};return r.attach(t),t};return h}),define("gl",[],function(){var e={width:window.innerWidth,height:window.innerHeight,viewAngle:45,aspect:window.innerWidth/window.innerHeight,near:.1,far:1e4};return e.renderer=new THREE.WebGLRenderer,e.camera=new THREE.PerspectiveCamera(e.viewAngle,e.aspect,e.near,e.far),e.scene=new THREE.Scene,e.scene.add(e.camera),e.camera.position={x:0,y:-120,z:40},e.camera.lookAt({x:0,y:0,z:0}),e.renderer.setSize(e.width,e.height),e.renderer.shadowMapEnabled=!0,e.renderer.shadowMapSoft=!0,document.body.appendChild(e.renderer.domElement),e}),define("gui/element",["canvas","events"],function(e,t){var n=function(n){var r=[],i={eat:function(e){for(var t in e)i[t]=e[t]},add:function(e){r.push(e)},position:{X:0,Y:0},size:{width:0,height:0},init:function(){i.fire("init");for(var e=0;e<r.length;e++)r[e].init()},click:function(e){if(e.X>i.position.X&&e.X<i.position.X+i.size.width&&e.Y>i.position.Y&&e.Y<i.position.Y+i.size.height){for(var t=0;t<r.length;t++)r[t].click({X:e.X-i.position.X,Y:e.Y-i.position.Y});i.fire("click")}},run:function(){i.fire("run"),e.context.save(),e.context.translate(i.position.X,i.position.Y);for(var t=0;t<r.length;t++)r[t].run();e.context.restore()}};return n&&i.eat(n),t.attach(i),i};return n}),define("gui/modal",["easing","canvas","gui/element"],function(e,t,n){var r="rgba(0, 0, 0, 0.5)",i=80,s=500;return function(i){var o=0,u,a,f={X:0,Y:t.height/2-i.height/2},l=t.context,c=n({font:"48px RapscallionRegular",position:f,size:i,lifetime:function(){return Date.now()-o},clear:function(e){c.time=Date.now()-o,o=Date.now(),u=0,a=-i.width,f.X=u,c.done=e}});return c.on("init",function(){c.background=document.createElement("canvas"),c.background.width=t.width,c.background.height=t.height,c.background.getContext("2d").drawImage(t.element,0,0),o=Date.now(),u=-i.width,a=t.width/2-i.width/2+i.width,f.X=u}),c.on("run",function(){if(o===0)return;var t=Date.now()-o,n=-1;t<s?f.X=e(t,u,a,s)|0:(f.X=u+a,a<0&&c.done&&c.done()),l.drawImage(c.background,0,0),l.fillStyle=r,l.fillRect(f.X,f.Y,i.width,i.height)}),c}}),define("gui/label",["canvas","gui/element"],function(e,t){var n=function(n,r){var i=t({position:{X:200,Y:20},size:{width:0,height:0},text:n,fontSize:48,font:"RapscallionRegular",color:"white",align:"center",background:null});return i.on("init",function(){if(!i.initialized){e.context.font=i.fontSize+"px "+i.font;var t=e.context.measureText(i.text);i.size={width:t.width+i.fontSize/2,height:i.fontSize*1.4};if(i.align="center")i.position.X-=i.size.width/2-i.fontSize/4;i.initialized=!0}}),i.on("run",function(){i.background&&(e.context.fillStyle=i.background,e.context.fillRect(i.position.X-i.fontSize/4,i.position.Y-i.fontSize/4,i.size.width,i.size.height)),e.context.fillStyle=i.color,e.context.font=i.fontSize+"px "+i.font,e.context.textAlign="left",e.context.textBaseline="top",e.context.fillText(i.text,i.position.X,i.position.Y)}),r&&i.eat(r),i};return n}),define("gui/badge",["canvas","gui/element"],function(e,t){var n=function(n){var r=t({position:{X:30,Y:80},size:{width:48,height:48},title:"Ghost",description:"Finished level without being seen",active:!1});return r.on("run",function(){r.active||(e.context.globalAlpha=.2),r.image&&e.context.drawImage(r.image,0,0,r.image.width,r.image.height,r.position.X,r.position.Y,r.size.width,r.size.height),e.context.font="32px RapscallionRegular",e.context.fillText(r.title,r.position.X+r.size.width+10,r.position.Y-8),e.context.font="14px Arial",e.context.fillText(r.description,r.position.X+r.size.width+10,r.position.Y+28),e.context.globalAlpha=1}),n&&r.eat(n),r};return n}),define("version",{app:"0.0.0.1"}),require(["game","canvas","resources","menu","play","gl","gui/modal","gui/element","gui/label","gui/badge","version"],function(e,t,n,r,i,s,o,u,a,f,l){var c={width:window.innerWidth,height:window.innerHeight};t.size(c),t.clear("black"),console.log("CargoRun v"+l.app);var h=JSON.parse(localStorage.getItem("highscores")||"[]"),p=i(s);n.on("load",function(){console.log("loaded"),e.run()}),n.load({fuelicon:"images/fuel.png",grass:"images/grass.png",dirt:"images/dirt.png",grid:"images/grid.png",bricks:"images/bricks.png",star:"images/star.png",music:"audio/music.mp3",boop:"audio/boop.ogg",select:"audio/select.ogg",ship:"3d/ship3.js",fuel:"3d/fuel.js",bump:"3d/bump.js",bridge:"3d/wingedbridge.js"}),p.on("menu",function(){e.state=T}),p.on("gameover",function(t){function r(e,t){h.push({name:e,score:t}),h.sort(function(e,t){return t.score-e.score}),h.length>10&&(h.length=10),localStorage.setItem("highscores",JSON.stringify(h))}e.state=x;var i=localStorage.getItem("name")||"";if(h.length<9||t>h[h.length-1].score)if(navigator.isCocoonJS){var s=function(e){r(e,t),localStorage.setItem("name",e),CocoonJS.App.onTextDialogFinished.removeEventListener(s),n.music.stop()};CocoonJS.App.showTextDialog("new high score!","enter your name",i,CocoonJS.App.KeyboardType.TEXT,"cancel","submit"),CocoonJS.App.onTextDialogFinished.addEventListener(s)}else{var o=prompt("enter your name");r(o,t)}});var d=["intro","level1","level2"],v=0,m=o({width:400,height:360});m.add(a("Level Complete"));var g=a("replay",{position:{X:40,Y:320},fontSize:22}),y=a("continue",{position:{X:360,Y:320},fontSize:22});g.on("click",function(){n.select.play(),p.respawn(),e.state=p}),y.on("click",function(){console.log("continue ..."),v++,v>=d.length&&(v=0),p.level=d[v],p.respawn(),e.state=p});var b={ghost:f({position:{X:30,Y:80},size:{width:48,height:48},image:n.badge,title:"Ghost",description:"Finished level without being seen"}),pacifist:f({position:{X:30,Y:160},size:{width:48,height:48},image:n.rose,title:"Pacifist",description:"Finished level without killing anyone"}),butcher:f({position:{X:30,Y:240},size:{width:48,height:48},image:n.grimreaper,title:"Butcher",description:"Killed them all."})};m.add(g),m.add(y),m.add(b.ghost),m.add(b.pacifist),m.add(b.butcher);var w={init:function(){w.content=["Programming","Armen138","Music","TBD","Graphics","Armen138"]},run:function(){t.clear("black"),t.context.fillStyle="white",t.context.font="24px GputeksRegular",t.context.textAlign="center";for(var e=0;e<w.content.length;e++)t.context.font=e%2===0?"12px Arial":"24px GputeksRegular",t.context.fillText(w.content[e],162,e*30+30);t.context.textAlign="left"},clear:function(e){e()},click:function(t){e.state=N}},E={init:function(){},run:function(){t.clear("black"),t.context.fillStyle="white",t.context.font="24px GputeksRegular";for(var e=0;e<h.length;e++)t.context.textAlign="left",t.context.fillText(e+1,20,e*30+30),t.context.textAlign="center",t.context.fillText(h[e].name,162,e*30+30),t.context.textAlign="right",t.context.fillText(h[e].score,304,e*30+30);t.context.textAlign="left"},clear:function(e){t.clear("black"),e()},click:function(t){e.state=N}},S=r(t.element,[{label:"Restart",action:function(){p.reset(),e.state=p}},{label:"Menu",action:function(){e.state=N}}],n.gameover),x=r(t.element,[{label:"Restart",action:function(){p.reset(),e.state=p}},{label:"Menu",action:function(){e.state=N}},{label:"Highscores",action:function(){e.state=E}}],n.winner),T=r(t.element,[{label:"Resume",action:function(){e.state=p}},{label:"Menu",action:function(){e.state=N}}]),N=r(t.element,[{label:"Play",action:function(){p.reset(),e.state=p}},{label:"Credits",action:function(){e.state=w}},{label:"Highscores",action:function(){e.state=E}}],n.logo);window.addEventListener("blur",function(){e.state==p&&(e.state=T)}),e.paused=T,e.state=N}),define("main",function(){});